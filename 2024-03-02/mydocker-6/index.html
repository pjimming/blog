<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>《自己动手写docker》阅读笔记--第六章 容器虚拟网络 - 江明说|Jimmy Talk</title><meta http-equiv=x-dns-prefetch-control content="on">
<link rel=dns-prefetch href=//cdn.jsdelivr.net><link rel=dns-prefetch href=//pjimming.github.io><meta name=Description content="江明说"><meta property="og:url" content="https://blog.pjmcode.top/2024-03-02/mydocker-6/"><meta property="og:site_name" content="江明说|Jimmy Talk"><meta property="og:title" content="《自己动手写docker》阅读笔记--第六章 容器虚拟网络"><meta property="og:description" content="介绍容器相关的虚拟网络，如 veth、bridge、路由表、iptables"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-02T16:08:25+08:00"><meta property="article:modified_time" content="2024-03-13T00:12:42+08:00"><meta property="article:tag" content="Docker"><meta property="og:image" content="https://blog.pjmcode.top/2024-03-02/mydocker-6/featured-image.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.pjmcode.top/2024-03-02/mydocker-6/featured-image.png"><meta name=twitter:title content="《自己动手写docker》阅读笔记--第六章 容器虚拟网络"><meta name=twitter:description content="介绍容器相关的虚拟网络，如 veth、bridge、路由表、iptables"><meta name=application-name content="江明说"><meta name=apple-mobile-web-app-title content="江明说"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/images/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.pjmcode.top/2024-03-02/mydocker-6/><link rel=prev href=https://blog.pjmcode.top/2024-02-29/acm/><link rel=next href=https://blog.pjmcode.top/2024-03-03/sysinfo/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"《自己动手写docker》阅读笔记--第六章 容器虚拟网络","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.pjmcode.top\/2024-03-02\/mydocker-6\/"},"genre":"posts","keywords":"docker","wordcount":2623,"url":"https:\/\/blog.pjmcode.top\/2024-03-02\/mydocker-6\/","datePublished":"2024-03-02T16:08:25+08:00","dateModified":"2024-03-13T00:12:42+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"PanJM"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="江明说|Jimmy Talk"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/favicon.ico data-srcset="/images/favicon.ico, /images/favicon.ico 1.5x, /images/favicon.ico 2x" data-sizes=auto alt=/images/favicon.ico title=/images/favicon.ico>Jimmy Talk</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/><i class='fa-solid fa-box-archive'></i> 所有文章 </a><a class=menu-item href=/tags/><i class='fa-solid fa-tag'></i> 标签 </a><a class=menu-item href=/categories/><i class='fa-solid fa-table-list'></i> 分类 </a><a class=menu-item href=/friend/><i class='fa-solid fa-user-group'></i> 友链 </a><a class=menu-item href=/book-list/><i class='fa-solid fa-book'></i> 书单 </a><a class=menu-item href=/about/><i class='fa-regular fa-address-card'></i> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="江明说|Jimmy Talk"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/favicon.ico data-srcset="/images/favicon.ico, /images/favicon.ico 1.5x, /images/favicon.ico 2x" data-sizes=auto alt=/images/favicon.ico title=/images/favicon.ico>Jimmy Talk</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title><i class='fa-solid fa-box-archive'></i>所有文章</a><a class=menu-item href=/tags/ title><i class='fa-solid fa-tag'></i>标签</a><a class=menu-item href=/categories/ title><i class='fa-solid fa-table-list'></i>分类</a><a class=menu-item href=/friend/ title><i class='fa-solid fa-user-group'></i>友链</a><a class=menu-item href=/book-list/ title><i class='fa-solid fa-book'></i>书单</a><a class=menu-item href=/about/ title><i class='fa-regular fa-address-card'></i>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">《自己动手写docker》阅读笔记--第六章 容器虚拟网络</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/pjimming/ title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>PanJM</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/docker/><i class="far fa-folder fa-fw" aria-hidden=true></i>Docker</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2024-03-02>2024-03-02</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 2623 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 6 分钟&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/2024-03-02/mydocker-6/featured-image.png data-srcset="/2024-03-02/mydocker-6/featured-image.png, /2024-03-02/mydocker-6/featured-image.png 1.5x, /2024-03-02/mydocker-6/featured-image.png 2x" data-sizes=auto alt=/2024-03-02/mydocker-6/featured-image.png title=/2024-03-02/mydocker-6/featured-image.png width=1410 height=738></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-linux-虚拟网络设备>1. Linux 虚拟网络设备</a><ul><li><a href=#linux-veth>Linux Veth</a><ul><li><a href=#veth-pair>veth-pair</a></li><li><a href=#网络命名空间>网络命名空间</a></li><li><a href=#demo>Demo</a></li><li><a href=#查看对端设备>查看对端设备</a></li></ul></li><li><a href=#linux-bridge>Linux Bridge</a></li></ul></li><li><a href=#2-linux-路由表>2. Linux 路由表</a></li><li><a href=#3-linux-iptables>3. Linux iptables</a><ul><li><a href=#masquerade>MASQUERADE</a></li><li><a href=#dnat>DNAT</a></li></ul></li><li><a href=#4-结尾>4. 结尾</a></li></ul></nav></div></div><div class=content id=content><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>警告<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content><span>这篇文章最后修改于</span>
<span class=timeago datetime=2024-03-13T00:12:42 title="March 13, 2024">March 13, 2024</span>
<span>，请鉴别其时效性，以免造成不必要的麻烦。</span></div></div></div><p>介绍容器相关的虚拟网络，如 veth、bridge、路由表、iptables</p><hr><h2 id=1-linux-虚拟网络设备>1. Linux 虚拟网络设备</h2><h3 id=linux-veth>Linux Veth</h3><h4 id=veth-pair>veth-pair</h4><p>顾名思义，veth-pair 就是一对的虚拟设备接口，和 tap/tun 设备不同的是，它都是成对出现的。一端连着协议栈，一端彼此相连着。</p><p>一般用于跨 namespace 通信。</p><blockquote><p>Linux 中默认不同 net namespace 设备无法通信。</p></blockquote><h4 id=网络命名空间>网络命名空间</h4><p>为了支持网络协议栈的多个实例，Linux 在网络栈中引入了网络命名空间。这些独立的协议栈被隔离到不同的命名空间中。</p><p>处理不同网络命令空间中的通信</p><p>​
<img class=lazyload src=/svg/loading.min.svg data-src=/2024-03-02/mydocker-6/assets/image-20240302151857-sgh7la1.png data-srcset="/2024-03-02/mydocker-6/assets/image-20240302151857-sgh7la1.png, /2024-03-02/mydocker-6/assets/image-20240302151857-sgh7la1.png 1.5x, /2024-03-02/mydocker-6/assets/image-20240302151857-sgh7la1.png 2x" data-sizes=auto alt=/2024-03-02/mydocker-6/assets/image-20240302151857-sgh7la1.png title=image-20240302151857-sgh7la1.png width=436 height=315>​</p><h4 id=demo>Demo</h4><p>本次演示中，先创建一个网络命名空间，然后创建一个 veth 设备对，将设备对分别切换到不同的命名空间中，实现不同命名空间的互相通信。</p><p>准备一个 net namespace</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pjm2001:~# ip netns add netns1
</span></span><span class=line><span class=cl>root@pjm2001:~# ip netns list
</span></span><span class=line><span class=cl>netns1
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span></code></pre></td></tr></table></div></div><p>创建两个 Veth 设备对(<code>ip link add &lt;veth name> type veth peer name &lt;peer></code>​)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pjm2001:~# ip link add veth0 <span class=nb>type</span> veth peer name veth1
</span></span><span class=line><span class=cl>root@pjm2001:~# ip link show
</span></span><span class=line><span class=cl>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class=m>65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class=line><span class=cl>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc mq state UP mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 00:15:5d:c4:21:04 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>3: veth1@veth0: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu <span class=m>1500</span> qdisc noop state DOWN mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether aa:ed:e3:6e:27:4b brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>4: veth0@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu <span class=m>1500</span> qdisc noop state DOWN mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether fe:2a:a9:3a:08:af brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span></code></pre></td></tr></table></div></div><p>此时两个 veth 都在默认 net namespace 中，为了测试，先将其中一个切换到 netns1</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pjm2001:~# ip link <span class=nb>set</span> veth1 netns netns1
</span></span><span class=line><span class=cl>root@pjm2001:~# ip link show
</span></span><span class=line><span class=cl>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class=m>65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class=line><span class=cl>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc mq state UP mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 00:15:5d:c4:21:04 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>4: veth0@if3: &lt;BROADCAST,MULTICAST&gt; mtu <span class=m>1500</span> qdisc noop state DOWN mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether fe:2a:a9:3a:08:af brd ff:ff:ff:ff:ff:ff link-netns netns1
</span></span><span class=line><span class=cl>root@pjm2001:~# ip netns <span class=nb>exec</span> netns1 ip link show
</span></span><span class=line><span class=cl>1: lo: &lt;LOOPBACK&gt; mtu <span class=m>65536</span> qdisc noop state DOWN mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class=line><span class=cl>3: veth1@if4: &lt;BROADCAST,MULTICAST&gt; mtu <span class=m>1500</span> qdisc noop state DOWN mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether aa:ed:e3:6e:27:4b brd ff:ff:ff:ff:ff:ff link-netnsid <span class=m>0</span>
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span></code></pre></td></tr></table></div></div><p>至此，两个不同的命名空间各自有一个 Veth，不过还不能通信，因为我们还没给它们分配 IP</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pjm2001:~# ip netns <span class=nb>exec</span> netns1 ip addr add 10.1.1.1/24 dev veth1
</span></span><span class=line><span class=cl>root@pjm2001:~# ip addr add 10.1.1.2/24 dev veth0
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span></code></pre></td></tr></table></div></div><p>再启动它们</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pjm2001:~# ip netns <span class=nb>exec</span> netns1 ip link <span class=nb>set</span> dev veth1 up
</span></span><span class=line><span class=cl>root@pjm2001:~# ip link <span class=nb>set</span> dev veth0 up
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span></code></pre></td></tr></table></div></div><p>现在两个网络命名空间可以互相通信了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pjm2001:~# ping 10.1.1.1
</span></span><span class=line><span class=cl>PING 10.1.1.1 <span class=o>(</span>10.1.1.1<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.1.1.1: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span>0.166 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.1.1.1: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>2</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span>0.053 ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 10.1.1.1: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>3</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span>0.051 ms
</span></span><span class=line><span class=cl>^C
</span></span><span class=line><span class=cl>--- 10.1.1.1 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>3</span> packets transmitted, <span class=m>3</span> received, 0% packet loss, <span class=nb>time</span> 2077ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 0.051/0.090/0.166/0.053 ms
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span></code></pre></td></tr></table></div></div><p>至此，Veth 设备对的基本原理和用法演示结束。</p><blockquote><p>Docker 内部，Veth 设备对也是连通容器与宿主机的主要网络设备。</p></blockquote><h4 id=查看对端设备>查看对端设备</h4><p>由于 Veth 设备对被移动到另一个命名空间后在当前命名空间中就看不到了。</p><p>那么该如何知道这个 Veth 设备的另一端在哪儿呢？</p><p>可以使用 ethtool 工具来查看：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pjm2001:~# ip netns <span class=nb>exec</span> netns1 ethtool -S veth1
</span></span><span class=line><span class=cl>NIC statistics:
</span></span><span class=line><span class=cl>     peer_ifindex: <span class=m>4</span>
</span></span><span class=line><span class=cl>     rx_queue_0_xdp_packets: <span class=m>0</span>
</span></span><span class=line><span class=cl>     rx_queue_0_xdp_bytes: <span class=m>0</span>
</span></span><span class=line><span class=cl>     rx_queue_0_drops: <span class=m>0</span>
</span></span><span class=line><span class=cl>     rx_queue_0_xdp_redirect: <span class=m>0</span>
</span></span><span class=line><span class=cl>     rx_queue_0_xdp_drops: <span class=m>0</span>
</span></span><span class=line><span class=cl>     rx_queue_0_xdp_tx: <span class=m>0</span>
</span></span><span class=line><span class=cl>     rx_queue_0_xdp_tx_errors: <span class=m>0</span>
</span></span><span class=line><span class=cl>     tx_queue_0_xdp_xmit: <span class=m>0</span>
</span></span><span class=line><span class=cl>     tx_queue_0_xdp_xmit_errors: <span class=m>0</span>
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span></code></pre></td></tr></table></div></div><p>peer_ifindex 就是另一端的接口设备的序列号，这里是 4。</p><p>然后在到默认命名空间取看 序列化 4 代表的是什么设备：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pjm2001:~# ip link <span class=p>|</span> grep ^4
</span></span><span class=line><span class=cl>4: veth0@if3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc noqueue state UP mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span></code></pre></td></tr></table></div></div><p>可以看到 序列号 4 的设备就是 veth0，它的另一端就是 netns1 中的 veth1，它们互为 peer。</p><h3 id=linux-bridge>Linux Bridge</h3><p>Bridge 虚拟设备是用来桥接的网络设备，它相当于现实世界中的交换机，可以连接不同的网络设备，当请求到达 Bridge 设备时，可以通过报文中的 Mac 地址进行广播或转发。</p><p>例如，我们可以创建一个 Bridge 设备来连接 Namespace 中的网络设备和宿主机上的网络。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pjm2001:~# ip netns add ns1
</span></span><span class=line><span class=cl>root@pjm2001:~# ip link add veth0 <span class=nb>type</span> veth peer name veth1
</span></span><span class=line><span class=cl>root@pjm2001:~# ip link <span class=nb>set</span> veth1 netns ns1
</span></span><span class=line><span class=cl>root@pjm2001:~# ip link
</span></span><span class=line><span class=cl>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class=m>65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class=line><span class=cl>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc mq state UP mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 00:15:5d:c4:21:04 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>7: veth0@if6: &lt;BROADCAST,MULTICAST&gt; mtu <span class=m>1500</span> qdisc noop state DOWN mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 1e:f3:a4:95:47:79 brd ff:ff:ff:ff:ff:ff link-netns ns1
</span></span><span class=line><span class=cl>root@pjm2001:~# brctl addbr br0
</span></span><span class=line><span class=cl>root@pjm2001:~# brctl addif br0 eth0
</span></span><span class=line><span class=cl>root@pjm2001:~# brctl addif br0 veth0
</span></span><span class=line><span class=cl>root@pjm2001:~# brctl show br0
</span></span><span class=line><span class=cl>bridge name     bridge id               STP enabled     interfaces
</span></span><span class=line><span class=cl>br0             8000.00155dc42104       no              eth0
</span></span><span class=line><span class=cl>                                                        veth0
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span></code></pre></td></tr></table></div></div><p><a href=https://zhuanlan.zhihu.com/p/339070912 target=_blank rel="noopener noreffer">linux bridge 实践</a></p><p>​
<img class=lazyload src=/svg/loading.min.svg data-src=/2024-03-02/mydocker-6/assets/image-20240302152531-ndnh3f2.png data-srcset="/2024-03-02/mydocker-6/assets/image-20240302152531-ndnh3f2.png, /2024-03-02/mydocker-6/assets/image-20240302152531-ndnh3f2.png 1.5x, /2024-03-02/mydocker-6/assets/image-20240302152531-ndnh3f2.png 2x" data-sizes=auto alt=/2024-03-02/mydocker-6/assets/image-20240302152531-ndnh3f2.png title=image-20240302152531-ndnh3f2.png width=420 height=259>​</p><h2 id=2-linux-路由表>2. Linux 路由表</h2><p>路由表是 Linux 内核的一个模块，通过定义路由表来决定在某个网络 Namespace 中包的流向，从而定义请求会到哪个网络设备上。</p><p>​
<img class=lazyload src=/svg/loading.min.svg data-src=/2024-03-02/mydocker-6/assets/image-20240302153313-sjvuy7l.png data-srcset="/2024-03-02/mydocker-6/assets/image-20240302153313-sjvuy7l.png, /2024-03-02/mydocker-6/assets/image-20240302153313-sjvuy7l.png 1.5x, /2024-03-02/mydocker-6/assets/image-20240302153313-sjvuy7l.png 2x" data-sizes=auto alt=/2024-03-02/mydocker-6/assets/image-20240302153313-sjvuy7l.png title=image-20240302153313-sjvuy7l.png width=384 height=225>​</p><p>继续以上面的例子演示</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 启动宿主机上的虚拟网络设备，</span>
</span></span><span class=line><span class=cl>root@pjm2001:~# ip link <span class=nb>set</span> veth0 up
</span></span><span class=line><span class=cl>root@pjm2001:~# ip link <span class=nb>set</span> br0 up
</span></span><span class=line><span class=cl><span class=c1># 给ns1中的虚拟网络设备设置IP并启动它</span>
</span></span><span class=line><span class=cl>root@pjm2001:~# ip netns <span class=nb>exec</span> ns1 ip addr add 172.18.0.2/24 dev veth1
</span></span><span class=line><span class=cl>root@pjm2001:~# ip netns <span class=nb>exec</span> ns1 ip link <span class=nb>set</span> dev veth1 up
</span></span><span class=line><span class=cl>root@pjm2001:~# ip netns <span class=nb>exec</span> ns1 ip link show veth1
</span></span><span class=line><span class=cl>6: veth1@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc noqueue state UP mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 16:94:1d:b5:77:bf brd ff:ff:ff:ff:ff:ff link-netnsid <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=c1># 分别设置ns1网络空间的路由和宿主机上的路由</span>
</span></span><span class=line><span class=cl><span class=c1># default代表0.0.0.0/0,即在Net Namespace中的所有流量都经过veth1的网络设备流出</span>
</span></span><span class=line><span class=cl>root@pjm2001:~# ip netns <span class=nb>exec</span> ns1 route add default dev veth1
</span></span><span class=line><span class=cl><span class=c1># 在宿主机上将172.18.0.0/24网段的请求路由到br0网桥</span>
</span></span><span class=line><span class=cl>root@pjm2001:~# route add -net 172.18.0.0/24 dev br0
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span></code></pre></td></tr></table></div></div><p>通过设置路由，对 IP 地址的请求就能正确被路由到对应的网络设备上，从而实现通信，如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 查看宿主机的IP地址</span>
</span></span><span class=line><span class=cl>root@pjm2001:~# ip addr show eth0
</span></span><span class=line><span class=cl>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc mq master br0 state UP group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 00:15:5d:c4:21:04 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>    inet 172.23.52.96/20 brd 172.23.63.255 scope global eth0
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>    inet6 fe80::215:5dff:fec4:2104/64 scope link
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl><span class=c1># 从Namespace中访问宿主机的地址</span>
</span></span><span class=line><span class=cl>root@pjm2001:~# ip netns <span class=nb>exec</span> ns1 ping -c <span class=m>1</span> 172.23.52.96
</span></span><span class=line><span class=cl>PING 172.23.52.96 <span class=o>(</span>172.23.52.96<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 172.23.52.96: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span>0.053 ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- 172.23.52.96 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>1</span> packets transmitted, <span class=m>1</span> received, 0% packet loss, <span class=nb>time</span> 0ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 0.053/0.053/0.053/0.000 ms
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span><span class=line><span class=cl><span class=c1># 从宿主机访问Namespace中的网络地址</span>
</span></span><span class=line><span class=cl>root@pjm2001:~# ip netns <span class=nb>exec</span> ns1 ip addr show veth1
</span></span><span class=line><span class=cl>6: veth1@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc noqueue state UP group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 16:94:1d:b5:77:bf brd ff:ff:ff:ff:ff:ff link-netnsid <span class=m>0</span>
</span></span><span class=line><span class=cl>    inet 172.18.0.2/24 scope global veth1
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>    inet6 fe80::1494:1dff:feb5:77bf/64 scope link
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>root@pjm2001:~# ping -c <span class=m>1</span> 172.18.0.2
</span></span><span class=line><span class=cl>PING 172.18.0.2 <span class=o>(</span>172.18.0.2<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 172.18.0.2: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span>0.050 ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- 172.18.0.2 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>1</span> packets transmitted, <span class=m>1</span> received, 0% packet loss, <span class=nb>time</span> 0ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 0.050/0.050/0.050/0.000 ms
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span></code></pre></td></tr></table></div></div><p>到此就实现了通过网桥连接不同 Namespace 网络了。</p><h2 id=3-linux-iptables>3. Linux iptables</h2><p>iptables 是对 Linux 内核的 netfilter 模块进行操作和展示的工具，用来管理包的流动和转送。iptables 定义了一套链式处理的结构，在网络包传输的各个阶段可以使用不同的策略对包进行加工、传送或丢弃。</p><p>在容器虚拟化的技术中，经常会用到两种策略 MASQUERADE 和 DNAT，用于容器和宿主机外部的网络通信。</p><h3 id=masquerade>MASQUERADE</h3><p>iptables 中的 MASQUERADE 策略可以将请求包中的源地址转换成一个网络设备的地址。</p><p>比如上述例子中的那个 Namespace 中网络设备的地址是 172.18.0.2, 这个地址虽然在宿主机上可以路由到 br0 网桥，但是到达宿主机外部之后，是不知道如何路由到这个 IP 地址的，所以如果要请求外部地址的话，需要先通过 MASQUERADE 策略将这个 IP 转换成宿主机出口网卡的 IP。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 打开IP转发</span>
</span></span><span class=line><span class=cl>root@pjm2001:~# sysctl -w net.ipv4.conf.all.forwarding<span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl>net.ipv4.conf.all.forwarding <span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=c1># 对Namespace中发出的包添加网络地址转换</span>
</span></span><span class=line><span class=cl>root@pjm2001:~# iptables -t nat -A POSTROUTING -s 172.18.0.0/24 -o eth0 -j MAS
</span></span><span class=line><span class=cl>QUERADE
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span></code></pre></td></tr></table></div></div><p>在 Namespace 中请求宿主机外部地址时，将 Namespace 中的源地址转换成宿主机的地址作为源地址，就可以在 Namespace 中访问宿主机外的网络了。</p><h3 id=dnat>DNAT</h3><p>iptables 中的 DNAT 策略也是做网络地址的转换，不过它是要更换目标地址，经常用于将内部网络地址的端口映射到外部去。</p><p>比如，上面那个例子中的 Namespace 如果需要提供服务给宿主机之外的应用去请求要怎么办呢?</p><p>外部应用没办法直接路由到 172.18.0.2 这个地址，这时候就可以用到 DNAT 策略。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 将宿主机上80端口的请求转发到Namespace里的IP上</span>
</span></span><span class=line><span class=cl>root@pjm2001:~# iptables -t nat -A PREROUTING -p tcp -m tcp --dport <span class=m>80</span> -j DNAT --to-destination 172.18.0.2:80
</span></span><span class=line><span class=cl>root@pjm2001:~#
</span></span></code></pre></td></tr></table></div></div><p>这样就可以把宿主机上 80 端口的 TCP 请求转发到 Namespace 中的地址 172.18.0.2:80,从而实现外部的应用调用。</p><p>‍</p><h2 id=4-结尾>4. 结尾</h2><p>做完上述实验之后，记得恢复网络设置。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@pjm2001:~# ip link delete veth0
</span></span><span class=line><span class=cl>root@pjm2001:~# ip link delete br0
</span></span><span class=line><span class=cl>root@pjm2001:~# ping github.com
</span></span><span class=line><span class=cl>PING github.com <span class=o>(</span>20.205.243.166<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 20.205.243.166 <span class=o>(</span>20.205.243.166<span class=o>)</span>: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>100</span> <span class=nv>time</span><span class=o>=</span><span class=m>236</span> ms
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 20.205.243.166 <span class=o>(</span>20.205.243.166<span class=o>)</span>: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>2</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>100</span> <span class=nv>time</span><span class=o>=</span><span class=m>233</span> ms
</span></span><span class=line><span class=cl>^C
</span></span><span class=line><span class=cl>--- github.com ping statistics ---
</span></span><span class=line><span class=cl><span class=m>2</span> packets transmitted, <span class=m>2</span> received, 0% packet loss, <span class=nb>time</span> 1266ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 233.168/234.758/236.349/1.590 ms
</span></span><span class=line><span class=cl>root@pjm2001:~# ip netns delete ns1
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2024-03-13&nbsp;<a class=git-hash href=https://github.com/pjimming/blog/commit/1c115203430829ae7510133fab1bb6fca881f8d8 target=_blank title="commit by pjm(2556323541@qq.com) 1c115203430829ae7510133fab1bb6fca881f8d8: post: blog/20240312">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>1c11520</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/2024-03-02/mydocker-6/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://blog.pjmcode.top/2024-03-02/mydocker-6/ data-title="《自己动手写docker》阅读笔记--第六章 容器虚拟网络" data-hashtags=docker><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://blog.pjmcode.top/2024-03-02/mydocker-6/ data-hashtag=docker><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://blog.pjmcode.top/2024-03-02/mydocker-6/ data-title="《自己动手写docker》阅读笔记--第六章 容器虚拟网络"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://blog.pjmcode.top/2024-03-02/mydocker-6/ data-title="《自己动手写docker》阅读笔记--第六章 容器虚拟网络"><i data-svg-src=/lib/simple-icons/icons/line.min.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://blog.pjmcode.top/2024-03-02/mydocker-6/ data-title="《自己动手写docker》阅读笔记--第六章 容器虚拟网络" data-image=featured-image.png><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/docker/>Docker</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2024-02-29/acm/ class=prev rel=prev title=我那一路坎坷的ACM算法竞赛生涯><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>我那一路坎坷的ACM算法竞赛生涯</a>
<a href=/2024-03-03/sysinfo/ class=next rel=next title=Linux常用命令--系统篇>Linux常用命令--系统篇<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app>Giscus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/pjimming/ target=_blank>潘江明</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=备案编号" target=_blank>浙ICP备2024074882号</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{giscus:{category:"Announcements",categoryId:"DIC_kwDOLZmgDc4Cdm7x",darkTheme:"preferred_color_scheme",emitMetadata:"0",inputPosition:"top",lang:"zh-CN",lazyLoading:!1,lightTheme:"light",mapping:"pathname",reactionsEnabled:"1",repo:"pjimming/blog-comment",repoId:"R_kgDOLZmgDQ"}},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://cdn.staticfile.net/jquery/2.2.4/jquery.min.js></script><script type=text/javascript src=/js/custom.js></script></body></html>